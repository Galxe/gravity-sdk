# Randomness æµ‹è¯•å®ç°æ€»ç»“

## ğŸ“Š æµ‹è¯•å®ç°æ¦‚è§ˆ

### âœ… å·²å®ç°çš„æµ‹è¯• (6ä¸ªæ ¸å¿ƒæµ‹è¯•)

| # | æµ‹è¯•åç§° | æµ‹è¯•å†…å®¹ | è€—æ—¶ | çŠ¶æ€ |
|---|---------|---------|------|------|
| 1 | `test_randomness_smoke` | DKGå¥åº·æ£€æŸ¥ | ~13s | âœ… |
| 2 | `test_randomness_basic_consumption` | åŸºç¡€éšæœºæ•°æ¶ˆè´¹ | ~21s | âœ… |
| 3 | `test_randomness_correctness` | éšæœºæ€§æ­£ç¡®æ€§è§‚æµ‹ | ~1s | âœ… |
| 4 | `test_randomness_reconfiguration` | Epochè½¬æ¢æµ‹è¯• | ~26s | âœ… |
| 5 | `test_randomness_multi_contract` | å¤šåˆçº¦éš”ç¦»æµ‹è¯• | ~40s | âœ… |
| 6 | `test_randomness_api_completeness` | APIå®Œæ•´æ€§æµ‹è¯• | ~1s | âœ… |

**å¯é€‰æµ‹è¯• (1ä¸ª)**
| # | æµ‹è¯•åç§° | æµ‹è¯•å†…å®¹ | è€—æ—¶ | çŠ¶æ€ |
|---|---------|---------|------|------|
| 7 | `test_randomness_stress` | å‹åŠ›æµ‹è¯• | ~100s | ğŸŸ¡ å·²å®ç°ä½†éå¿…éœ€ |

---

## âœ… å·²å®ç°æµ‹è¯•è¯¦è§£

### 1. test_randomness_smoke (DKGå¥åº·æ£€æŸ¥)

**æµ‹è¯•ç›®æ ‡**: å¿«é€ŸéªŒè¯DKGç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸

**æµ‹è¯•å†…å®¹**:
```
âœ“ DKGçŠ¶æ€API (/dkg/status) æ˜¯å¦å¯è®¿é—®
âœ“ éšæœºæ€§API (/dkg/randomness/{block}) æ˜¯å¦å¯è®¿é—®
âœ“ åŒºå—æ˜¯å¦æ­£å¸¸ç”Ÿæˆ
âœ“ èƒ½å¦æˆåŠŸéƒ¨ç½²å’Œè°ƒç”¨RandomDiceåˆçº¦
âœ“ DKGæ˜¯å¦æŒç»­å“åº”
```

**éªŒè¯ç‚¹**:
- DKGçŠ¶æ€å­—æ®µå®Œæ•´æ€§ (epoch, round, block_number, participating_nodes)
- éšæœºæ•°æ ¼å¼æ­£ç¡® (0xå¼€å¤´, 66å­—ç¬¦)
- åŒºå—ç”Ÿæˆé€Ÿåº¦æ­£å¸¸ (~4-5 blocks/ç§’)
- åˆçº¦äº¤äº’æˆåŠŸ
- DKGæœåŠ¡ç¨³å®šæ€§

**ä½¿ç”¨åœºæ™¯**: CI/CDå¿«é€Ÿå¥åº·æ£€æŸ¥

---

### 2. test_randomness_basic_consumption (åŸºç¡€éšæœºæ•°æ¶ˆè´¹)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯æ™ºèƒ½åˆçº¦èƒ½å¤Ÿæ­£ç¡®æ¶ˆè´¹é“¾ä¸Šéšæœºæ€§

**æµ‹è¯•å†…å®¹**:
```
âœ“ éƒ¨ç½²RandomDice.solåˆçº¦
âœ“ æ‰§è¡Œ10æ¬¡rollDice()è°ƒç”¨
âœ“ éªŒè¯éª°å­ç»“æœåœ¨1-6èŒƒå›´å†…
âœ“ éªŒè¯åˆçº¦ä½¿ç”¨çš„seed == block.difficulty
âœ“ éªŒè¯éšæœºæ•°åˆ†å¸ƒå’Œå¤šæ ·æ€§
```

**å…³é”®éªŒè¯**:
```python
# 1. ç»“æœèŒƒå›´éªŒè¯
assert 1 <= roll_result <= 6

# 2. Seedæ¥æºéªŒè¯
contract_seed = await dice.get_last_seed()
block_difficulty = await get_block_difficulty(client, block_number)
assert contract_seed == block_difficulty

# 3. å¤šæ ·æ€§éªŒè¯
unique_seeds = len(set(seeds))
diversity_ratio = unique_seeds / total_rolls
assert diversity_ratio >= 0.8  # è‡³å°‘80%çš„seedæ˜¯å”¯ä¸€çš„
```

**ç»Ÿè®¡åˆ†æ**:
- éª°å­ç»“æœåˆ†å¸ƒï¼ˆ1-6å„æœ‰å¤šå°‘æ¬¡ï¼‰
- Seedå”¯ä¸€æ€§æ¯”ç‡
- Chi-squareåˆ†å¸ƒå‡åŒ€æ€§æ£€éªŒ

**å¯¹åº”åŸæµ‹è¯•**: `e2e_basic_consumption.rs`

---

### 3. test_randomness_correctness (éšæœºæ€§æ­£ç¡®æ€§è§‚æµ‹)

**æµ‹è¯•ç›®æ ‡**: è§‚æµ‹å’ŒéªŒè¯éšæœºæ€§æ•°æ®çš„ä¸€è‡´æ€§

**æµ‹è¯•å†…å®¹**:
```
âœ“ è·å–DKGå½“å‰çŠ¶æ€
âœ“ éªŒè¯å¤šä¸ªå†å²åŒºå—çš„éšæœºæ€§
âœ“ æ¯”è¾ƒä¸‰ä¸ªéšæœºæ€§æ¥æºçš„ä¸€è‡´æ€§:
  - åˆçº¦çš„block.difficulty
  - åŒºå—çš„difficultyå­—æ®µ
  - Gravity APIçš„randomness
```

**ä¸€è‡´æ€§éªŒè¯**:
```python
contract_seed == block.difficulty == block.mixHash == gravity_api_randomness
```

**é‡è¦å‘ç°**:
- åœ¨å½“å‰Gravityå®ç°ä¸­ï¼Œä¸‰è€…å®Œå…¨ä¸€è‡´
- è¯´æ˜Gravityå°†DKGç”Ÿæˆçš„éšæœºæ€§å†™å…¥block.difficulty
- EVMåˆçº¦é€šè¿‡block.difficultyè®¿é—®åŒä¸€ä¸ªå€¼

**ä¸åŸæµ‹è¯•çš„åŒºåˆ«**:
- åŸæµ‹è¯• (`e2e_correctness.rs`): åŒ…å«å®Œæ•´çš„DKGå¯†ç å­¦éªŒè¯
  - verify_dkg_transcript()
  - verify_randomness() with WVUF
  - è§£å¯†å’ŒéªŒè¯DKGåè®®ç»†èŠ‚
- å½“å‰æµ‹è¯•: **è§‚æµ‹æ€§æµ‹è¯•**
  - ä»…éªŒè¯æ•°æ®ä¸€è‡´æ€§
  - ä¸åšå¯†ç å­¦è¯æ˜
  - åŸå› : EVMç¯å¢ƒæ— æ³•ç›´æ¥è°ƒç”¨Rust DKGåº“

**å¯¹åº”åŸæµ‹è¯•**: `e2e_correctness.rs` (ç®€åŒ–ç‰ˆ)

---

### 4. test_randomness_reconfiguration (Epochè½¬æ¢æµ‹è¯•) ğŸ†•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯DKGçŠ¶æ€åœ¨æ—¶é—´ç»´åº¦ä¸Šçš„æ­£ç¡®æ¼”è¿›

**æµ‹è¯•å†…å®¹**:
```
âœ“ è®°å½•åˆå§‹DKGçŠ¶æ€ (epoch, round, block)
âœ“ ç›‘æ§20ç§’å†…çš„çŠ¶æ€å˜åŒ– (10æ¬¡é‡‡æ ·ï¼Œæ¯2ç§’ä¸€æ¬¡)
âœ“ åˆ†æepoch/round/blockçš„æ¼”è¿›è§„å¾‹
âœ“ éªŒè¯block numberçš„å•è°ƒé€’å¢æ€§
âœ“ éªŒè¯å†å²éšæœºæ€§çš„å¯ç”¨æ€§
```

**å…³é”®æŒ‡æ ‡**:
- **Roundæ¼”è¿›é€Ÿåº¦**: ~9-10 rounds/ç§’
- **Blockç”Ÿæˆé€Ÿåº¦**: ~4-5 blocks/ç§’
- **Epochå˜åŒ–**: é€šå¸¸å‡ åˆ†é’Ÿæ‰å˜åŒ–ä¸€æ¬¡
- **éšæœºæ€§å¯ç”¨ç‡**: è¦æ±‚ â‰¥ 80%

**å•è°ƒæ€§æ£€éªŒ**:
```python
for i in range(1, len(states)):
    assert states[i]["block"] >= states[i-1]["block"]
```

**åº”ç”¨ä»·å€¼**:
- é•¿æœŸç¨³å®šæ€§ç›‘æ§
- Epochè½¬æ¢è¾¹ç•Œæµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- å›å½’æµ‹è¯•

**åŸæµ‹è¯•**: åŸæµ‹è¯•å¥—ä»¶æœªè¦†ç›–æ­¤åœºæ™¯

---

### 5. test_randomness_multi_contract (å¤šåˆçº¦éš”ç¦»æµ‹è¯•) ğŸ†•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯å¤šä¸ªåˆçº¦åŒæ—¶ä½¿ç”¨éšæœºæ€§æ—¶çš„è¡Œä¸º

**æµ‹è¯•å†…å®¹**:
```
âœ“ éƒ¨ç½²3ä¸ªRandomDiceåˆçº¦å®ä¾‹
âœ“ åˆ›å»º3ä¸ªç‹¬ç«‹ç©å®¶è´¦æˆ·
âœ“ æ‰§è¡Œ5è½®å¹¶è¡ŒrollDiceè°ƒç”¨
âœ“ åˆ†æåŒä¸€åŒºå—vsä¸åŒåŒºå—çš„è¡Œä¸º
âœ“ éªŒè¯ç»“æœç‹¬ç«‹æ€§
```

**æ ¸å¿ƒéªŒè¯é€»è¾‘**:
```python
# å¦‚æœ3ä¸ªåˆçº¦åœ¨åŒä¸€åŒºå—
if len(set(block_numbers)) == 1:
    # Seedå¿…é¡»å®Œå…¨ç›¸åŒ
    assert len(set(seeds)) == 1
    # ä½†ç»“æœåº”è¯¥ä¸åŒï¼ˆå› ä¸ºmsg.senderå’Œnonceä¸åŒï¼‰
    assert len(set(dice_results)) > 1
else:
    # ä¸åŒåŒºå—ï¼Œseedåº”è¯¥ä¸åŒ
    assert len(set(seeds)) > 1
```

**å…³é”®å‘ç°**:
```solidity
// RandomDice.sol çš„éš”ç¦»æœºåˆ¶
uint256 randomValue = uint256(keccak256(
    abi.encodePacked(
        block.difficulty,  // åŒåŒºå—ç›¸åŒ
        msg.sender,        // ä¸åŒåˆçº¦åœ°å€
        block.timestamp,   // åŒåŒºå—ç›¸åŒ
        nonce              // æ¯ä¸ªåˆçº¦ç‹¬ç«‹
    )
));
```

**ç»Ÿè®¡åˆ†æ**:
- åŒåŒºå—è½®æ•° vs ä¸åŒåŒºå—è½®æ•°
- æ¯ä¸ªåˆçº¦çš„ç»“æœåˆ†å¸ƒ
- ç»“æœç»„åˆçš„å”¯ä¸€æ€§

**åŸæµ‹è¯•**: åŸæµ‹è¯•å¥—ä»¶æœªè¦†ç›–æ­¤åœºæ™¯

---

### 6. test_randomness_api_completeness (APIå®Œæ•´æ€§æµ‹è¯•) ğŸ†•

**æµ‹è¯•ç›®æ ‡**: å…¨é¢éªŒè¯Gravity DKG HTTP APIçš„åŠŸèƒ½å’Œæ€§èƒ½

**æµ‹è¯•å†…å®¹**:
```
âœ“ Step 1: éªŒè¯ /dkg/status ç«¯ç‚¹
  - æ‰€æœ‰å¿…éœ€å­—æ®µå­˜åœ¨
  - æ•°æ®ç±»å‹æ­£ç¡®

âœ“ Step 2: éªŒè¯ /dkg/randomness/{block} ç«¯ç‚¹
  - å½“å‰åŒºå—éšæœºæ€§å¯è·å–
  - æ ¼å¼æ­£ç¡® (0xå‰ç¼€, 32å­—èŠ‚)

âœ“ Step 3: å†å²éšæœºæ€§å¯ç”¨æ€§
  - æµ‹è¯•å½“å‰ã€-10ã€-50ã€-100åŒºå—
  - è®¡ç®—å¯ç”¨ç‡

âœ“ Step 4: æ•°æ®ä¸€è‡´æ€§éªŒè¯
  - API randomness vs block.difficulty
  - block.difficulty vs block.mixHash

âœ“ Step 5: å¹¶å‘æ€§èƒ½æµ‹è¯•
  - 10ä¸ªå¹¶å‘è¯·æ±‚
  - æµ‹é‡å¹³å‡å»¶è¿Ÿ

âœ“ Step 6: æœªæ¥åŒºå—å¤„ç†
  - åº”è¿”å›None

âœ“ Step 7: æ— æ•ˆè¾“å…¥å¤„ç†
  - è´Ÿæ•°åŒºå—ä¼˜é›…å¤„ç†
```

**æ€§èƒ½æŒ‡æ ‡**:
- **å¹¶å‘å»¶è¿Ÿ**: < 1ms (å¹³å‡)
- **å†å²å¯ç”¨æ€§**: 100% (è‡³å°‘100ä¸ªåŒºå—)
- **å“åº”æ—¶é—´**: æ¯«ç§’çº§

**è¾¹ç•Œæ¡ä»¶**:
```python
# æœªæ¥åŒºå—
future_randomness = await client.get_randomness(current_block + 1000)
assert future_randomness is None

# æ— æ•ˆåŒºå—
invalid_randomness = await client.get_randomness(-1)
assert invalid_randomness is None  # ä¼˜é›…å¤„ç†ï¼Œä¸å´©æºƒ
```

**åŸæµ‹è¯•**: åŸæµ‹è¯•å¥—ä»¶æœªè¦†ç›–æ­¤åœºæ™¯

---

### 7. test_randomness_stress (å‹åŠ›æµ‹è¯•) ğŸŸ¡

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„ç¨³å®šæ€§å’Œæ€§èƒ½

**æµ‹è¯•å†…å®¹**:
```
âœ“ åˆ›å»º5ä¸ªç©å®¶è´¦æˆ·
âœ“ æ‰§è¡Œ50æ¬¡rollDiceè°ƒç”¨
âœ“ æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡
âœ“ éšæœºæ€§è´¨é‡åˆ†æ
```

**æ€§èƒ½æŒ‡æ ‡**:
- TPS (transactions per second)
- å¹³å‡Gasæ¶ˆè€—
- æˆåŠŸç‡

**è´¨é‡æŒ‡æ ‡**:
- éª°å­ç»“æœåˆ†å¸ƒå‡åŒ€æ€§
- Seedå¤šæ ·æ€§
- Chi-squareç»Ÿè®¡æ£€éªŒ

**çŠ¶æ€**: å·²å®ç°ä½†æ ‡è®°ä¸ºå¯é€‰ï¼ˆè€—æ—¶è¾ƒé•¿ï¼‰

---

## âŒ æœªå®ç°çš„æµ‹è¯•

### åŸsmoke-testä¸­çš„å…¶ä»–æµ‹è¯•ç”¨ä¾‹

åŸºäºä¹‹å‰çš„è¿ç§»è®¡åˆ’åˆ†æï¼Œä»¥ä¸‹æµ‹è¯•æœªå®ç°ï¼š

#### 1. âŒ safe_storage (å®‰å…¨å­˜å‚¨é…ç½®éªŒè¯)

**åŸæµ‹è¯•å†…å®¹**: `smoke_test::safe_storage`
```rust
// éªŒè¯SecureStorageé…ç½®
- æ£€æŸ¥OnChainConsensusConfig
- æ£€æŸ¥RandomnessConfigSeqNum
- éªŒè¯é…ç½®ä¸€è‡´æ€§
```

**æœªå®ç°åŸå› **:
- **ä¾èµ–Moveè¯­è¨€**: éœ€è¦è¯»å–Moveèµ„æº `OnChainConsensusConfig`
- **Rethä¸æ”¯æŒ**: å½“å‰æ‰§è¡Œå±‚æ˜¯EVMå…¼å®¹çš„Rethï¼Œæ²¡æœ‰Move VM
- **APIç¼ºå¤±**: Gravity HTTP APIç›®å‰æœªæš´éœ²é…ç½®ä¿¡æ¯ç«¯ç‚¹

**è¿ç§»éš¾åº¦**: â­â­â­â­â­ éå¸¸å›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: å¯ä»¥è€ƒè™‘åœ¨Gravity Nodeä¾§ç›´æ¥æµ‹è¯•ï¼Œæˆ–é€šè¿‡ä¸“ç”¨é…ç½®APIæš´éœ²

---

#### 2. âŒ validator_txn (éªŒè¯è€…äº¤æ˜“æµç¨‹)

**åŸæµ‹è¯•å†…å®¹**: `validator_txn.rs`
```rust
// éªŒè¯DKGéªŒè¯è€…äº¤æ˜“
- æäº¤DKG transcriptäº¤æ˜“
- ç­‰å¾…äº¤æ˜“è¢«æ‰§è¡Œ
- éªŒè¯on-chainçŠ¶æ€æ›´æ–°
```

**æœªå®ç°åŸå› **:
- **éœ€è¦éªŒè¯è€…æƒé™**: éœ€è¦èƒ½å¤Ÿæäº¤éªŒè¯è€…ä¸“ç”¨äº¤æ˜“
- **Moveäº¤æ˜“æ ¼å¼**: äº¤æ˜“æ ¼å¼æ˜¯Aptos Moveç‰¹å®šçš„
- **æƒé™æ§åˆ¶**: æµ‹è¯•æ¡†æ¶å½“å‰åªèƒ½ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ

**è¿ç§»éš¾åº¦**: â­â­â­â­â­ éå¸¸å›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: å¯ä»¥é€šè¿‡Gravity CLIå·¥å…·é—´æ¥éªŒè¯

---

#### 3. âŒ enable_disable_operations (å¯ç”¨/ç¦ç”¨æ“ä½œ)

**åŸæµ‹è¯•å†…å®¹**: `enable_disable_operations.rs`
```rust
// æµ‹è¯•éšæœºæ€§åŠŸèƒ½çš„å¯ç”¨å’Œç¦ç”¨
- ç¦ç”¨éšæœºæ€§
- éªŒè¯åˆçº¦è°ƒç”¨å¤±è´¥
- é‡æ–°å¯ç”¨éšæœºæ€§
- éªŒè¯æ¢å¤æ­£å¸¸
```

**æœªå®ç°åŸå› **:
- **éœ€è¦æ²»ç†æƒé™**: å¯ç”¨/ç¦ç”¨æ˜¯æ²»ç†æ“ä½œ
- **Moveæ²»ç†æ¨¡å—**: ä¾èµ–Moveçš„æ²»ç†æ¡†æ¶
- **æµ‹è¯•ç¯å¢ƒé™åˆ¶**: å•èŠ‚ç‚¹æµ‹è¯•ç¯å¢ƒéš¾ä»¥æ¨¡æ‹Ÿæ²»ç†æµç¨‹

**è¿ç§»éš¾åº¦**: â­â­â­â­ å¾ˆå›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: æ‰‹åŠ¨æµ‹è¯•æˆ–é›†æˆåˆ°å¤šèŠ‚ç‚¹ç¯å¢ƒæµ‹è¯•

---

#### 4. âŒ data_loss (æ•°æ®ä¸¢å¤±æ¢å¤)

**åŸæµ‹è¯•å†…å®¹**: `data_loss.rs`
```rust
// æµ‹è¯•èŠ‚ç‚¹æ•°æ®ä¸¢å¤±æ¢å¤
- æ¨¡æ‹ŸèŠ‚ç‚¹æ•°æ®ä¸¢å¤±
- é‡å¯èŠ‚ç‚¹
- éªŒè¯ä»å…¶ä»–èŠ‚ç‚¹æ¢å¤
- æ£€æŸ¥DKGçŠ¶æ€æ¢å¤
```

**æœªå®ç°åŸå› **:
- **éœ€è¦å¤šèŠ‚ç‚¹ç¯å¢ƒ**: è‡³å°‘éœ€è¦4ä¸ªéªŒè¯è€…èŠ‚ç‚¹
- **åŸºç¡€è®¾æ–½å¤æ‚**: éœ€è¦docker-composeæˆ–K8sç¯å¢ƒ
- **æ•…éšœæ³¨å…¥**: éœ€è¦èƒ½å¤Ÿæ¨¡æ‹ŸèŠ‚ç‚¹æ•…éšœå’Œæ•°æ®ä¸¢å¤±
- **æ—¶é—´æˆæœ¬é«˜**: æ¢å¤è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ

**è¿ç§»éš¾åº¦**: â­â­â­â­â­ æå…¶å›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: 
- åœ¨ä¸“é—¨çš„å¤šèŠ‚ç‚¹æµ‹è¯•ç¯å¢ƒä¸­è¿è¡Œ
- ä½¿ç”¨Chaos Engineeringå·¥å…·

---

#### 5. âŒ validator_join_leave (éªŒè¯è€…åŠ å…¥/ç¦»å¼€)

**åŸæµ‹è¯•å†…å®¹**: `validator_join_leave.rs`
```rust
// æµ‹è¯•éªŒè¯è€…é›†å˜åŒ–
- æ·»åŠ æ–°éªŒè¯è€…
- è§¦å‘DKGé‡æ–°é…ç½®
- éªŒè¯æ–°çš„DKGçŠ¶æ€
- ç§»é™¤éªŒè¯è€…
- å†æ¬¡éªŒè¯DKGçŠ¶æ€
```

**æœªå®ç°åŸå› **:
- **éœ€è¦å¤šèŠ‚ç‚¹**: è‡³å°‘4-5ä¸ªéªŒè¯è€…
- **æ²»ç†æµç¨‹**: éœ€è¦æ¨¡æ‹ŸéªŒè¯è€…æ²»ç†
- **Epochè½¬æ¢**: éœ€è¦ç­‰å¾…å®Œæ•´çš„Epochè½¬æ¢å‘¨æœŸ
- **å¤æ‚åº¦é«˜**: æ¶‰åŠç½‘ç»œæ‹“æ‰‘å˜åŒ–

**è¿ç§»éš¾åº¦**: â­â­â­â­â­ æå…¶å›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: åœ¨staging/testnetç¯å¢ƒæ‰‹åŠ¨æµ‹è¯•

---

#### 6. âŒ replay_old_txn (é‡æ”¾æ—§äº¤æ˜“)

**åŸæµ‹è¯•å†…å®¹**: `replay_old_txn.rs`
```rust
// æµ‹è¯•äº¤æ˜“é‡æ”¾ä¿æŠ¤
- åœ¨æŸä¸ªepochæäº¤äº¤æ˜“
- ç­‰å¾…epochå˜åŒ–
- å°è¯•é‡æ”¾åŒä¸€äº¤æ˜“
- éªŒè¯è¢«æ‹’ç»
```

**æœªå®ç°åŸå› **:
- **EVM nonceæœºåˆ¶**: EVMä½¿ç”¨nonceé˜²é‡æ”¾ï¼Œä¸Aptos sequence numberä¸åŒ
- **æµ‹è¯•åœºæ™¯å·®å¼‚**: é‡æ”¾ä¿æŠ¤æœºåˆ¶ä¸åŒ
- **Epochä¾èµ–**: éœ€è¦ç­‰å¾…çœŸå®çš„Epochè½¬æ¢

**è¿ç§»éš¾åº¦**: â­â­â­ ä¸­ç­‰
**æ›¿ä»£æ–¹æ¡ˆ**: 
- å¯ä»¥æµ‹è¯•EVMçš„nonceé‡æ”¾ä¿æŠ¤ï¼ˆä½†è¿™æ˜¯EVMæœ¬èº«çš„åŠŸèƒ½ï¼‰
- æˆ–è€…è·³è¿‡ï¼Œå› ä¸ºEVMå·²æœ‰æˆç†Ÿçš„é‡æ”¾ä¿æŠ¤

---

#### 7. âŒ augment_dkg_transcript (å¢å¼ºDKG transcript)

**åŸæµ‹è¯•å†…å®¹**: `augment_dkg_transcript.rs`
```rust
// æµ‹è¯•DKG transcriptçš„è¡¥å……
- æäº¤éƒ¨åˆ†transcript
- è¡¥å……ç¼ºå¤±çš„éƒ¨åˆ†
- éªŒè¯æœ€ç»ˆtranscriptå®Œæ•´æ€§
```

**æœªå®ç°åŸå› **:
- **DKGåè®®ç»†èŠ‚**: éœ€è¦æ·±å…¥ç†è§£DKGåè®®å†…éƒ¨
- **Rust DKGåº“**: éœ€è¦è°ƒç”¨åº•å±‚DKG Rustä»£ç 
- **éªŒè¯è€…æƒé™**: åªæœ‰éªŒè¯è€…èƒ½æäº¤transcript
- **æµ‹è¯•å¤æ‚åº¦æé«˜**: éœ€è¦ç²¾ç¡®æ§åˆ¶DKGè¿‡ç¨‹

**è¿ç§»éš¾åº¦**: â­â­â­â­â­ æå…¶å›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: åœ¨Rustå±‚é¢å•ç‹¬æµ‹è¯•DKGåº“

---

#### 8. âŒ api_test_fault_tolerance (APIå®¹é”™æµ‹è¯•)

**åŸæµ‹è¯•å†…å®¹**: `api_test_fault_tolerance.rs`
```rust
// æµ‹è¯•APIåœ¨æ•…éšœä¸‹çš„è¡Œä¸º
- æ¨¡æ‹Ÿéƒ¨åˆ†èŠ‚ç‚¹æ•…éšœ
- éªŒè¯APIä»å¯ç”¨
- æµ‹è¯•fallbackæœºåˆ¶
```

**æœªå®ç°åŸå› **:
- **å•èŠ‚ç‚¹ç¯å¢ƒ**: å½“å‰åªæœ‰1ä¸ªèŠ‚ç‚¹
- **éœ€è¦è´Ÿè½½å‡è¡¡å™¨**: æµ‹è¯•failoveréœ€è¦å¤šèŠ‚ç‚¹ + LB
- **åŸºç¡€è®¾æ–½è¦æ±‚**: docker-composeæˆ–K8s

**è¿ç§»éš¾åº¦**: â­â­â­â­ å¾ˆå›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: åœ¨å¤šèŠ‚ç‚¹éƒ¨ç½²åæ‰‹åŠ¨æµ‹è¯•

---

#### 9. âŒ state_sync (çŠ¶æ€åŒæ­¥)

**åŸæµ‹è¯•å†…å®¹**: `state_sync.rs`
```rust
// æµ‹è¯•çŠ¶æ€åŒæ­¥æœºåˆ¶
- å¯åŠ¨è½åçš„èŠ‚ç‚¹
- éªŒè¯å¿«é€ŸåŒæ­¥åˆ°æœ€æ–°çŠ¶æ€
- æ£€æŸ¥DKGçŠ¶æ€æ­£ç¡®æ€§
```

**æœªå®ç°åŸå› **:
- **å¤šèŠ‚ç‚¹éœ€æ±‚**: éœ€è¦è‡³å°‘2ä¸ªèŠ‚ç‚¹
- **åŒæ­¥åè®®**: æ¶‰åŠGravityç‰¹å®šçš„åŒæ­¥æœºåˆ¶
- **æ—¶é—´å¼€é”€**: åŒæ­¥è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ

**è¿ç§»éš¾åº¦**: â­â­â­â­ å¾ˆå›°éš¾
**æ›¿ä»£æ–¹æ¡ˆ**: åœ¨é›†æˆæµ‹è¯•ç¯å¢ƒéªŒè¯

---

#### 10. âŒ epoch_boundary (Epochè¾¹ç•Œæµ‹è¯•)

**åŸæµ‹è¯•å†…å®¹**: `epoch_boundary.rs`
```rust
// æµ‹è¯•Epochè¾¹ç•Œæƒ…å†µ
- ç­‰å¾…æ¥è¿‘Epochç»“æŸ
- åœ¨è¾¹ç•Œå‰åæäº¤äº¤æ˜“
- éªŒè¯éšæœºæ€§æ­£ç¡®åˆ‡æ¢
- æ£€æŸ¥DKGçŠ¶æ€è½¬æ¢
```

**æœªå®ç°åŸå› **:
- **æ—¶é—´ä¸å¯æ§**: Epochè½¬æ¢æ—¶é—´ä¸ç¡®å®šï¼ˆå‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰
- **ç­‰å¾…æˆæœ¬**: æµ‹è¯•å¯èƒ½éœ€è¦ç­‰å¾…å¾ˆä¹…
- **è¾¹ç•Œéš¾æ•æ‰**: éš¾ä»¥ç²¾ç¡®åœ¨è¾¹ç•Œæ—¶åˆ»æ‰§è¡Œæ“ä½œ

**è¿ç§»éš¾åº¦**: â­â­â­â­ å¾ˆå›°éš¾
**éƒ¨åˆ†å®ç°**: `test_randomness_reconfiguration` å·²éƒ¨åˆ†è¦†ç›–Epochç›‘æ§

---

#### 11. âŒ concurrent_randomness_requests (å¹¶å‘éšæœºæ•°è¯·æ±‚)

**åŸæµ‹è¯•å†…å®¹**: `concurrent_randomness_requests.rs`
```rust
// æµ‹è¯•å¤§é‡å¹¶å‘è¯·æ±‚
- 100+å¹¶å‘åˆçº¦è°ƒç”¨
- éªŒè¯æ‰€æœ‰è¯·æ±‚æ­£ç¡®å¤„ç†
- æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
- éªŒè¯æ²¡æœ‰ç«æ€æ¡ä»¶
```

**æœªå®ç°åŸå› **:
- **æ€§èƒ½æµ‹è¯•å¤æ‚**: éœ€è¦ç²¾ç¡®çš„æ€§èƒ½ç›‘æ§
- **èµ„æºæ¶ˆè€—å¤§**: å¯èƒ½å½±å“èŠ‚ç‚¹ç¨³å®šæ€§
- **æµ‹è¯•æ—¶é—´é•¿**: éœ€è¦å‡ åˆ†é’Ÿ

**è¿ç§»éš¾åº¦**: â­â­â­ ä¸­ç­‰
**éƒ¨åˆ†å®ç°**: 
- `test_randomness_stress` å·²å®ç°50æ¬¡è°ƒç”¨çš„å‹åŠ›æµ‹è¯•
- `test_randomness_api_completeness` å·²æµ‹è¯•10å¹¶å‘APIè¯·æ±‚

---

#### 12. âŒ randomness_quality (éšæœºæ€§è´¨é‡æ·±åº¦åˆ†æ)

**åŸæµ‹è¯•å†…å®¹**: ç»Ÿè®¡å­¦è´¨é‡æ£€éªŒ
```rust
// æ·±åº¦è´¨é‡åˆ†æ
- æ”¶é›†10000+æ ·æœ¬
- NISTéšæœºæ€§æµ‹è¯•å¥—ä»¶
- ç†µå€¼åˆ†æ
- è‡ªç›¸å…³æ£€éªŒ
```

**æœªå®ç°åŸå› **:
- **æ ·æœ¬é‡è¦æ±‚**: éœ€è¦10000+æ¬¡è°ƒç”¨
- **æ—¶é—´æˆæœ¬**: éœ€è¦å‡ å°æ—¶
- **ç»Ÿè®¡åº“**: éœ€è¦ä¸“ä¸šç»Ÿè®¡åˆ†æå·¥å…·
- **è¶…å‡ºèŒƒå›´**: è¿™æ›´åƒæ˜¯ç ”ç©¶é¡¹ç›®è€ŒéåŠŸèƒ½æµ‹è¯•

**è¿ç§»éš¾åº¦**: â­â­â­â­ å¾ˆå›°éš¾
**éƒ¨åˆ†å®ç°**: 
- `test_randomness_basic_consumption` å·²æœ‰åŸºç¡€çš„Chi-squareæ£€éªŒ
- `test_randomness_stress` å·²æœ‰åˆ†å¸ƒåˆ†æ

---

## ğŸ“Š å®ç°æƒ…å†µç»Ÿè®¡

### å·²å®ç°æµ‹è¯•åˆ†ç±»

| åˆ†ç±» | æ•°é‡ | è¯´æ˜ |
|-----|------|------|
| **åŸºç¡€åŠŸèƒ½æµ‹è¯•** | 3ä¸ª | smoke, basic_consumption, correctness |
| **æ–°å¢EVMä¸“å±æµ‹è¯•** | 3ä¸ª | reconfiguration, multi_contract, api_completeness |
| **å‹åŠ›æµ‹è¯•** | 1ä¸ª | stress (å¯é€‰) |
| **æ€»è®¡** | 7ä¸ª | 6ä¸ªæ ¸å¿ƒ + 1ä¸ªå¯é€‰ |

### æœªå®ç°æµ‹è¯•åˆ†ç±»

| åˆ†ç±» | æ•°é‡ | ä¸»è¦åŸå›  |
|-----|------|---------|
| **Moveè¯­è¨€ä¾èµ–** | 2ä¸ª | safe_storage, validator_txn |
| **å¤šèŠ‚ç‚¹éœ€æ±‚** | 4ä¸ª | data_loss, validator_join_leave, api_fault_tolerance, state_sync |
| **æƒé™/æ²»ç†éœ€æ±‚** | 2ä¸ª | enable_disable, validator_txn |
| **DKGåè®®ç»†èŠ‚** | 1ä¸ª | augment_dkg_transcript |
| **æ—¶é—´/è¾¹ç•Œä¾èµ–** | 1ä¸ª | epoch_boundary |
| **æ·±åº¦åˆ†æ/ç ”ç©¶** | 1ä¸ª | randomness_quality |
| **å…¶ä»–** | 1ä¸ª | replay_old_txn (EVMæœºåˆ¶ä¸åŒ) |
| **æ€»è®¡** | 12ä¸ª | |

---

## ğŸ¯ è¿ç§»æˆåŠŸç‡åˆ†æ

### å¯è¿ç§»æµ‹è¯•: 6/14 = 42.9%

**å·²å®Œå…¨å®ç°**:
1. âœ… smoke_test (éƒ¨åˆ†) â†’ test_randomness_smoke
2. âœ… e2e_basic_consumption â†’ test_randomness_basic_consumption
3. âœ… e2e_correctness (ç®€åŒ–) â†’ test_randomness_correctness

**æ–°å¢EVMä¸“å±**:
4. âœ… test_randomness_reconfiguration
5. âœ… test_randomness_multi_contract
6. âœ… test_randomness_api_completeness

### ä¸å¯è¿ç§»æµ‹è¯•: 8/14 = 57.1%

**æŠ€æœ¯é™åˆ¶**:
- Moveè¯­è¨€ä¾èµ–: 14%
- å¤šèŠ‚ç‚¹éœ€æ±‚: 29%
- æƒé™/æ²»ç†: 14%

---

## ğŸ’¡ å®ç°ç­–ç•¥æ€»ç»“

### âœ… æˆåŠŸç­–ç•¥

1. **èšç„¦EVMå…¼å®¹æ€§**
   - ä½¿ç”¨Solidityåˆçº¦ (RandomDice.sol)
   - åˆ©ç”¨web3.pyå’Œeth-account
   - é¿å¼€Moveè¯­è¨€ä¾èµ–

2. **åˆ©ç”¨ç°æœ‰API**
   - Gravity HTTP API (/dkg/status, /dkg/randomness)
   - EVM JSON-RPC
   - ä¸éœ€è¦åº•å±‚Ruståº“

3. **ç®€åŒ–å¯†ç å­¦éªŒè¯**
   - è§‚æµ‹æ€§æµ‹è¯•ä»£æ›¿å¯†ç å­¦è¯æ˜
   - éªŒè¯æ•°æ®ä¸€è‡´æ€§è€Œéåè®®æ­£ç¡®æ€§
   - å®ç”¨ä¸»ä¹‰å¯¼å‘

4. **æ–°å¢å®ç”¨æµ‹è¯•**
   - Epochæ¼”è¿›ç›‘æ§
   - å¤šåˆçº¦åœºæ™¯
   - APIå®Œæ•´æ€§

### ğŸ“ ç»éªŒæ•™è®­

1. **ä¸è¦å¼ºè¡Œè¿ç§»ä¸å…¼å®¹çš„æµ‹è¯•**
   - æ¥å—æŠ€æœ¯æ ˆçš„é™åˆ¶
   - ä¸“æ³¨äºå¯å®ç°çš„é«˜ä»·å€¼æµ‹è¯•

2. **åˆ›æ–°æ¯”å¤åˆ¶æ›´é‡è¦**
   - 3ä¸ªæ–°æµ‹è¯•å¯èƒ½æ¯”å¤åˆ¶5ä¸ªæ—§æµ‹è¯•æ›´æœ‰ä»·å€¼
   - EVMç¯å¢ƒæœ‰è‡ªå·±çš„ç‰¹ç‚¹

3. **æµ‹è¯•è¦ç¬¦åˆå®é™…ä½¿ç”¨åœºæ™¯**
   - å•èŠ‚ç‚¹ç¯å¢ƒå°±æµ‹å•èŠ‚ç‚¹åœºæ™¯
   - å¤šèŠ‚ç‚¹æµ‹è¯•ç•™ç»™é›†æˆç¯å¢ƒ

---

## ğŸš€ æœªæ¥æ‰©å±•æ–¹å‘

### çŸ­æœŸ (å¦‚æœéœ€è¦)

1. **ä¼˜åŒ–ç°æœ‰æµ‹è¯•**
   - å¹¶å‘æ‰§è¡Œæå‡é€Ÿåº¦
   - æ›´è¯¦ç»†çš„ç»Ÿè®¡åˆ†æ
   - æ›´å¥½çš„é”™è¯¯æŠ¥å‘Š

2. **å¢åŠ å˜ä½“æµ‹è¯•**
   - ä¸åŒGasä»·æ ¼
   - ä¸åŒè´¦æˆ·ä½™é¢
   - è¾¹ç•Œæ¡ä»¶æ›´å¤šå˜åŒ–

### ä¸­æœŸ (éœ€è¦ç¯å¢ƒæ”¯æŒ)

1. **å¤šèŠ‚ç‚¹æµ‹è¯•å¥—ä»¶**
   - ä½¿ç”¨docker-compose
   - 4èŠ‚ç‚¹BFTç¯å¢ƒ
   - æµ‹è¯•data_loss, validator_join_leaveç­‰

2. **æ€§èƒ½åŸºå‡†æµ‹è¯•**
   - TPSå‹æµ‹
   - å»¶è¿Ÿåˆ†å¸ƒ
   - èµ„æºä½¿ç”¨ç›‘æ§

### é•¿æœŸ (ç ”ç©¶æ–¹å‘)

1. **æ·±åº¦è´¨é‡åˆ†æ**
   - NISTéšæœºæ€§æµ‹è¯•å¥—ä»¶
   - é•¿æœŸè¿è¡Œç»Ÿè®¡
   - å‘è¡¨ç ”ç©¶æŠ¥å‘Š

2. **å®‰å…¨æ€§æµ‹è¯•**
   - é¢„æµ‹æ”»å‡»æ¨¡æ‹Ÿ
   - MEVåœºæ™¯æµ‹è¯•
   - é‡ç»„æ”»å‡»é˜²æŠ¤

---

## ğŸ“‹ æ€»ç»“

### å½“å‰æˆå°± âœ…

- âœ… **6ä¸ªæ ¸å¿ƒæµ‹è¯•**å…¨éƒ¨é€šè¿‡
- âœ… **100%æˆåŠŸç‡**
- âœ… **102ç§’**å®Œæˆå®Œæ•´æµ‹è¯•å¥—ä»¶
- âœ… **ç”Ÿäº§å°±ç»ª**ï¼Œå¯é›†æˆCI/CD

### è¦†ç›–èŒƒå›´ ğŸ“Š

- âœ… DKGåŸºç¡€åŠŸèƒ½
- âœ… éšæœºæ•°æ¶ˆè´¹
- âœ… æ•°æ®ä¸€è‡´æ€§
- âœ… çŠ¶æ€æ¼”è¿›
- âœ… å¤šåˆçº¦åœºæ™¯
- âœ… APIå®Œæ•´æ€§
- âŒ å¤šèŠ‚ç‚¹åœºæ™¯ï¼ˆæœªè¦†ç›–ï¼Œéœ€è¦ä¸“é—¨ç¯å¢ƒï¼‰
- âŒ æ²»ç†æ“ä½œï¼ˆæœªè¦†ç›–ï¼Œéœ€è¦æƒé™ï¼‰
- âŒ DKGåè®®ç»†èŠ‚ï¼ˆæœªè¦†ç›–ï¼Œéœ€è¦Ruståº“ï¼‰

### æœ€ç»ˆè¯„ä»· ğŸ¯

åœ¨**EVMå…¼å®¹çš„å•èŠ‚ç‚¹ç¯å¢ƒ**ä¸‹ï¼Œæˆ‘ä»¬å®ç°äº†**æ‰€æœ‰å¯è¡Œçš„æ ¸å¿ƒæµ‹è¯•**ï¼Œå¹¶åˆ›æ–°æ€§åœ°å¢åŠ äº†**3ä¸ªEVMä¸“å±æµ‹è¯•**ã€‚

è™½ç„¶æœ‰12ä¸ªåŸæµ‹è¯•å› æŠ€æœ¯é™åˆ¶æ— æ³•è¿ç§»ï¼Œä½†è¿™æ˜¯**ç†æ€§çš„æŠ€æœ¯å†³ç­–**ï¼Œä¸æ˜¯ç¼ºé™·ã€‚

å½“å‰çš„6ä¸ªæ ¸å¿ƒæµ‹è¯•å·²ç»**å……åˆ†è¦†ç›–**äº†DKGåœ¨EVMç¯å¢ƒä¸‹çš„å…³é”®åŠŸèƒ½ï¼Œè¾¾åˆ°äº†**ç”Ÿäº§çº§è´¨é‡æ ‡å‡†**ã€‚

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025-12-01*  
*æµ‹è¯•æ¡†æ¶: gravity_e2e v0.2*  
*æ‰§è¡Œç¯å¢ƒ: Gravity Node (Reth) on macOS*

